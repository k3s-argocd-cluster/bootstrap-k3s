### Generated by ansible :: demelopment.k3s.argocd@render_templates ###
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: manifest-tool
  annotations:
    tekton.dev/displayName: "manifest-tool"
    tekton.dev/platforms: "linux/amd64,linux/s390x,linux/ppc64le,linux/arm64"
spec:
  description: >-
    The manifest-tool task will allow you to combine multiple arch-specific
    OCI images (which already need to be pushed to the registry) into one
    multi-arch manifest list and push the same into a registry.
  params:
  - name: platforms
    type: string
  - name: template
    type: string
  - name: target
    type: string
  results:
  - name: digest
  steps:
  - name: push-from-args
    image: "mplatform/manifest-tool:alpine-v2.0.6@sha256:61ce656e03d50b3779838413e02d1ff8e57b832b18e1e3e25a1d7d1c5fc3f67d"
    args:
      - --insecure
      - --docker-cfg
      - $(workspaces.dockerconfig.path)
      - push
      - from-args
      - --platforms
      - $(params.platforms)
      - --template
      - $(params.template)
      - --target
      - $(params.target)
    stdoutConfig:
      path: /shared/manifest-tool-stdout
    volumeMounts:
    - name: steps-shared
      mountPath: /shared
  - name: parse-digest
    image: "busybox:1.35.0@sha256:dd6a1bfed218f1993989a9df6fb2c7cda92ea51bf1dbf281ce71ad7749d1007d"
    command:
      - sh
      - -c
      - printf "%s" "$(cat /shared/manifest-tool-stdout | sed -rn 's/.*sha256:([a-z0-9]+)\s[0-9]*/sha256:\1/p')" > $(results.digest.path)
    volumeMounts:
    - name: steps-shared
      mountPath: /shared
  workspaces:
    - name: dockerconfig
      description: Includes a docker `config.json`
  volumes:
  - name: steps-shared
    emptyDir: {}